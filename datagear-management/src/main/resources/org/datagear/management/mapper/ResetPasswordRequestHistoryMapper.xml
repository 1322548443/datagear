<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.datagear.management.domain.ResetPasswordRequestHistory">

	<insert id="insert">
		INSERT INTO DATAGEAR_RESET_PSD_REQUEST_HISTORY
			(
			RESET_PSD_REQ_ID, RESET_PSD_USER_ID, RESET_PSD_PASSWORD,
			RESET_PSD_TIME, RESET_PSD_PRINCIPAL,
			RESET_PSD_EFFECTIVE_TIME, HISTORY_CREATE_TIME
			)
		VALUES
			(
			#{entity.resetPasswordRequest.id}, #{entity.resetPasswordRequest.user.id}, #{entity.resetPasswordRequest.password},
			#{entity.resetPasswordRequest.time}, #{entity.resetPasswordRequest.principal},
			#{entity.effectiveTime}, #{entity.createTime}
			)
	</insert>
	
	<delete id="deleteBefore">
		DELETE FROM DATAGEAR_RESET_PSD_REQUEST_HISTORY
		WHERE
			HISTORY_CREATE_TIME <![CDATA[ < ]]> #{createTime}
	</delete>
	
	<select id="getById" resultType="org.datagear.management.domain.ResetPasswordRequestHistory">
		SELECT
			T.*
		FROM
			(<include refid="queryView" />) T
		WHERE
			T.${_iq_}resetPasswordRequest.id${_iq_} = #{id}
	</select>
	
	<select id="pagingQueryCount" resultType="int">
		SELECT
			COUNT(*)
		FROM
			(<include refid="queryView" />) T
		WHERE
			<include refid="queryCondition" />
	</select>
	
	<select id="pagingQuery" resultType="org.datagear.management.domain.ResetPasswordRequestHistory">
		<include refid="common.pagingQueryHead" />
			SELECT
				T.*
			FROM
				(<include refid="queryView" />) T
			WHERE
				<include refid="queryCondition" />
			<include refid="common.queryOrder" />
		<include refid="common.pagingQueryFoot" />
	</select>
	
	<sql id="queryView">
		SELECT
			A.RESET_PSD_REQ_ID AS ${_iq_}resetPasswordRequest.id${_iq_},
			A.RESET_PSD_USER_ID AS ${_iq_}resetPasswordRequest.user.id${_iq_},
			A.RESET_PSD_PASSWORD AS ${_iq_}resetPasswordRequest.password${_iq_},
			A.RESET_PSD_TIME AS ${_iq_}resetPasswordRequest.time${_iq_},
			A.RESET_PSD_PRINCIPAL AS ${_iq_}resetPasswordRequest.principal${_iq_},
			A.RESET_PSD_EFFECTIVE_TIME AS ${_iq_}effectiveTime${_iq_},
			A.HISTORY_CREATE_TIME AS ${_iq_}createTime${_iq_},
			B.USER_NAME AS ${_iq_}resetPasswordRequest.user.name${_iq_},
			B.USER_REAL_NAME AS ${_iq_}resetPasswordRequest.user.realName${_iq_}
		FROM
			DATAGEAR_RESET_PSD_REQUEST_HISTORY A,
			DATAGEAR_USER B
		WHERE
			A.RESET_PSD_USER_ID = B.USER_ID
	</sql>
	
	<sql id="queryCondition">
		1 = 1
		<if test="queryKeyword != null">
		AND
		(
			${_iq_}resetPasswordRequest.user.id${_iq_} LIKE #{queryKeyword} OR
			${_iq_}resetPasswordRequest.user.name${_iq_} LIKE #{queryKeyword} OR
			${_iq_}resetPasswordRequest.user.realName${_iq_} LIKE #{queryKeyword} OR
			${_iq_}resetPasswordRequest.principal${_iq_} LIKE #{queryKeyword}
		)
		</if>
		<include refid="common.queryCondition" />
	</sql>
</mapper>